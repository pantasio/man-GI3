function initFirebase(b,c,e,d){var f=null;setTimeout(function(b){"string"==typeof c?firebase.auth().signInWithCustomToken(c).then(function(){window.frdSocket=firebase.database();pushServiceLogger("FRD socket opened.");frdSocket.ref(".info/connected").on("value",function(b){!0===b.val()?pushServiceLogger("FRD socket changed state: connected"):pushServiceLogger("FRD socket changed state: disconnected")});pushServiceLogger("FRD socket created.");f=frdSocket.ref("channels/"+e);f.on("value",function(b){try{var c=
b.val();pushServiceLogger("FRD on message event triggered message length: "+JSON.stringify(c).length);"message"in c&&(handlePushSocketOnMessageForBabySitter(c.message),frdMSGPayloadHandler(c.message),pushServiceLogger("FRD msg payload: "+JSON.stringify(c.message.data)))}catch(g){pushServiceLogger("!!! Error occurred in FRD on message handler: "+g,"error")}});pushSocketOpenedActions()})["catch"](function(c){"code"in c?pushServiceLogger("Login Failed!",c.code,"error"):"message"in c?pushServiceLogger("Error message: ",
c.message,"error"):console.error("Error occurred while trying to auth to Firebase",c);try{console.error(c),pushServiceLogger('FRD Auth Error: "'+JSON.stringify(c)+'"',"error")}catch(h){}recordPUSHHealthCheckEvent({push_type:"frd-socket-open",attempt:1,success:0,completion_time:0});"auth/invalid-custom-token"===c.code&&setTimeout(function(){d++;getFRDToken({attempt:d})},2E3)}):setTimeout(function(){d++;getFRDToken({attempt:d})},2E3)},100)}var firebaseApp;
function isPushLibLoaded(){var b=!1;"undefined"!=typeof firebase&&(b=!0);return b}
function getFRDToken(b){var c={current:1,max:2};"undefined"!=typeof b&&"attempt"in b&&(c.current=b.attempt);"native-app"==clientRunningScript||isPushLibLoaded()?c.current<=c.max&&(b=baseUrl+"/setup"+buildClientSpecificRequestParamsForLogging(),$.ajax({type:"GET",url:b,timeout:1E4,xhrFields:{withCredentials:!0},success:function(b){if(!b.error||"user_not_logged_in"!==b.error)if("token"in b&&"channel_id"in b)if("config"in b)try{"undefined"==typeof firebaseApp?defineFirebaseApp({attempt:c,server_resp:b}):
firebase.app()["delete"]().then(function(){defineFirebaseApp({attempt:c,server_resp:b})})["catch"](function(b){console.error('Error occurred deleting the firebase app: "'+b+'"')})}catch(d){console.error('Error reconfiging the firebase app:  "'+d+'"')}else initFirebase(b.client_key,b.token,b.channel_id,c.current);else getFRDToken({attempt:c.current+1})},error:function(b,d){getFRDToken({attempt:c.current+1})}})):(b=getLanguageSpecificText("push_js_lib_load_error_pt1",globalDefaultLanguage)+' <a href="javascript:void(0)" onclick="window.location.reload();">'+
getLanguageSpecificText("push_js_lib_load_error_pt2",globalDefaultLanguage)+"</a> "+getLanguageSpecificText("push_js_lib_load_error_pt3",globalDefaultLanguage),4>c.current?(console.info({message:"push lib load failure. try again in 3 seconds",attempt_count:c.current}),setTimeout(function(){getFRDToken({attempt:++c.current})},3E3)):displayAlertMessage(b,"error",6E4))}
function defineFirebaseApp(b){try{var c=b.server_resp,e=c.config;firebaseApp=firebase.initializeApp(e);initFirebase(c.client_key,c.token,c.channel_id,b.attempt.current);5>Math.floor(100*Math.random())&&"apiKey"in e&&e.apiKey.substr(e.apiKey.length-2)}catch(d){console.error("Error occurred defining firebase app: "+d)}}
function frdMSGPayloadHandler(b){"native-app"==clientRunningScript?(scrubIncomingCAPIforLogs(a),alertMainAppWindowOfPushSocketEvent({event:"message",capi:a}),globalTsLastPushRcvd=new Date):processIncomingPUSH(b.data)}
function closeAndReAttemptOpenFRDSocket(){"native-app"!=clientRunningScript?firebase.auth().signOut().then(function(){pushServiceLogger("Signed out of Firebase instance.  AKA Closing FRD Socket.");recordPUSHHealthCheckEvent({push_type:"frd-socket-close",attempt:0,success:0,completion_time:0});getFRDToken()})["catch"](function(b){getFRDToken();console.error("Error signing out the app!",b)}):"native-app"==clientRunningScript&&checkIfScriptIsLoadedInDesktopBG()&&closePushSocket()};