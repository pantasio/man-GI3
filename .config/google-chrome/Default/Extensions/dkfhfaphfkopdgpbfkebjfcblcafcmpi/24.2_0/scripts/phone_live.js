var currentPageURL=window.location.href,baseUrl="https://textyserver.appspot.com",globalObjOfDismissedNotifTimeoutIDs={};
function checkForExistingPhoneLiveViewPopout(a){var c=chrome.extension.getURL("html/phone_live.html");currentTabViewURL=c;a.hasOwnProperty("view")&&(currentTabViewURL+="#view="+a.view);chrome.tabs.query({url:c},function(b){0<b.length?a.hasOwnProperty("focus_existing")?(b=b[0],b.hasOwnProperty("windowId")&&chrome.windows.update(b.windowId,{focused:!0})):a.hasOwnProperty("get_latest_notifs_for_existing")&&getAllNotificationsFromPhone():a.hasOwnProperty("popout_if_none_found")&&popoutPhoneNotifLiveView({url:currentTabViewURL})})}
function popoutPhoneNotifLiveView(a){if(a.hasOwnProperty("url")){a=a.url;var c=screen.width-357,b=39;-1<navigator.appVersion.indexOf("Mac")&&(b=22);chrome.windows.create({width:350,height:600+b,focused:!0,left:c,type:"popup",url:a+"&client=crx-popout"})}}
function getAllNotificationsFromPhone(){issueRequestForGCMToBeSentToPhone({action:"get_all_device_notifications",ajax_error_callback:function(){recordGetAllTransactionGA({label:"Ajax-Error"})}});clearTimeout(globalPhoneNotifsAckReturnTimeout);clearTimeout(globalPhoneNotifsPendingIndicatorTimeout)}
function issueRequestForGCMToBeSentToPhone(a){if(!a.hasOwnProperty("action"))return console.error(new Date+'Missing "action" for request to send GCM to phone'),!1;var c=baseUrl+"/client",b=a.action;requestDataObj={"function":"send",deviceType:"ac2dm",source_client:32,action:a.action,action_data:"N/A"};reqTimeout=4E3;a.hasOwnProperty("timeout")&&(reqTimeout=a.timeout);a.hasOwnProperty("action_data")&&(requestDataObj.action_data=a.action_data);a.hasOwnProperty("type")&&(requestDataObj.type=a.type);
a.hasOwnProperty("phone")&&(requestDataObj.phone=a.phone);$.ajax({url:c,type:"POST",data:requestDataObj,dataType:"text",timeout:reqTimeout,success:function(c,d,e){a.hasOwnProperty("additional_ajax_success_callback")?(additionalCallback=a.additional_ajax_success_callback,handleC2DMRequestResponse(b,c,additionalCallback)):handleC2DMRequestResponse(b,c)},error:function(c,d,e){a.hasOwnProperty("ajax_error_callback")&&a.ajax_error_callback();console.error('Error: "'+d+'" occurred while making the "'+b+
'" request to GAE at: '+new Date)},complete:function(){a.hasOwnProperty("additional_ajax_complete_callback")&&a.additional_ajax_complete_callback()}})}function handleC2DMRequestResponse(a,c,b){(-1<c.indexOf("sent to phone")||-1<c.indexOf("phone call initiated successfully"))&&"undefined"!=typeof b&&b()};