(function(){"use strict";var e,t,r,o=this;!function(o){var i,n,s,a,u={},c={},l={},d={},p=Object.prototype.hasOwnProperty,f=[].slice,m=/\.js$/;function v(e,t){return p.call(e,t)}function g(e,t){var r,o,i,n,s,a,u,c,d,p,f,v=t&&t.split("/"),g=l.map,y=g&&g["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&m.test(e[s])&&(e[s]=e[s].replace(m,"")),"."===e[0].charAt(0)&&v&&(e=v.slice(0,v.length-1).concat(e)),d=0;d<e.length;d++)if("."===(f=e[d]))e.splice(d,1),d-=1;else if(".."===f){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((v||y)&&g){for(d=(r=e.split("/")).length;d>0;d-=1){if(o=r.slice(0,d).join("/"),v)for(p=v.length;p>0;p-=1)if((i=g[v.slice(0,p).join("/")])&&(i=i[o])){n=i,a=d;break}if(n)break;!u&&y&&y[o]&&(u=y[o],c=d)}!n&&u&&(n=u,a=c),n&&(r.splice(0,a,n),e=r.join("/"))}return e}function y(e,t){return function(){var r=f.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),n.apply(o,r.concat([e,t]))}}function h(e){return function(t){u[e]=t}}function b(e){if(v(c,e)){var t=c[e];delete c[e],d[e]=!0,i.apply(o,t)}if(!v(u,e)&&!v(d,e))throw new Error("No "+e);return u[e]}function S(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function w(e){return e?S(e):[]}s=function(e,t){var r,o,i=S(e),n=i[0],s=t[1];return e=i[1],n&&(r=b(n=g(n,s))),n?e=r&&r.normalize?r.normalize(e,(o=s,function(e){return g(e,o)})):g(e,s):(n=(i=S(e=g(e,s)))[0],e=i[1],n&&(r=b(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:r}},a={require:function(e){return y(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:(t=e,function(){return l&&l.config&&l.config[t]||{}})};var t}},i=function(e,t,r,i){var n,l,p,f,m,g,S,P=[],_=typeof r;if(g=w(i=i||e),"undefined"===_||"function"===_){for(t=!t.length&&r.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if("require"===(l=(f=s(t[m],g)).f))P[m]=a.require(e);else if("exports"===l)P[m]=a.exports(e),S=!0;else if("module"===l)n=P[m]=a.module(e);else if(v(u,l)||v(c,l)||v(d,l))P[m]=b(l);else{if(!f.p)throw new Error(e+" missing "+l);f.p.load(f.n,y(i,!0),h(l),{}),P[m]=u[l]}p=r?r.apply(u[e],P):void 0,e&&(n&&n.exports!==o&&n.exports!==u[e]?u[e]=n.exports:p===o&&S||(u[e]=p))}else e&&(u[e]=r)},e=t=n=function(e,t,r,u,c){if("string"==typeof e)return a[e]?a[e](t):b(s(e,w(t)).f);if(!e.splice){if((l=e).deps&&n(l.deps,l.callback),!t)return;t.splice?(e=t,t=r,r=null):e=o}return t=t||function(){},"function"==typeof r&&(r=u,u=c),u?i(o,e,t,r):setTimeout(function(){i(o,e,t,r)},4),n},n.config=function(e){return n(e)},e._defined=u,(r=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),v(u,e)||v(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}();var i,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},u=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});r("common/services/form-detection/form-profile",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/services/form-detection/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/enums/auto-fill-action",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAction||(t.AutoFillAction={})).Login="Login",r.Email="Email",r.Address="Address",r.PersonalName="PersonalName"}),r("common/enums/auto-fill-input-category",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillInputCategory||(t.AutoFillInputCategory={})).Name="name",r.FullName="fullName",r.FirstName="firstName",r.LastName="lastName",r.Address="address",r.Email="email",r.Password="password",r.UserName="userName"}),r("common/enums/auto-fill-method",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAlgorithm||(t.AutoFillAlgorithm={})).Legacy="Legacy",r.Euclidean="Euclidean"}),r("common/enums/feature-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.FeatureType||(t.FeatureType={})).AngularFrontendEnabled="angularFrontendEnabled",r.AutoFillControl="autofill_control",r.AutoFillTest="autofill_test",r.BetterGeneratePasswordEnabled="better_generate_password_enabled",r.Block30="block_3_0",r.EmergencyAccessRestricted="emergency_access_restricted",r.FamiliesEnabled="families_enabled",r.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",r.FamilySharedFoldersEnabled="family_shared_folders_enabled",r.FormfillMigration="formfill_migration",r.Freamon="freamon",r.HealthMonitoring="health_monitoring",r.ICOB="icob",r.IntroTutorialVersion="intro_tutorial_version",r.IsDogfood="isDogfood",r.IsInfieldEnabled="is_infield_enabled",r.IsMobileActive="is_mobile_active",r.NewSaveSite="new_save_site",r.OmarDrawer="omardrawer",r.OmarIa="omaria",r.OmarInfieldB="omar_infield_b",r.OmarInfieldC="omar_infield_c",r.OneToOneSharingRestricted="one_to_one_sharing_restricted",r.PasswordSubmittedEvent="password_submitted_event",r.Pdkdf2IterationsMigration="pbkdf2_iterations_migration",r.Retire30="retire_3_0",r.TryFamiliesEnabled="try_families_enabled",r.TutorialEnabled="tutorial_enabled",r.WebRequestEnabled="save_a_site_web_request",r.Ziggy="ziggy"}),r("common/enums/repository-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.RepositoryType||(t.RepositoryType={})).Feature="Feature",r.AutoFillState="AutoFillState"}),r("common/enums/resolver-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ResolverType||(t.ResolverType={})).PasswordSubmitted="Password Submitted",r.InjectedPasswordSubmitted="Injected Password Submitted"}),r("common/enums/save-site-action",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SaveSiteAction||(t.SaveSiteAction={})).Add="Add",r.OK="OK",r.Update="Update",r.NotNow="Not Now",r.Undo="Undo",r.Never="Never"}),r("common/enums/save-site-event-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SaveSiteDialogEventType||(t.SaveSiteDialogEventType={})).SaveSiteDialogAction="Save a Site Action Clicked",r.SaveSiteDialogDuplicateDeleteClicked="Save a Site Duplicate Delete Clicked",r.SaveSiteDialogDuplicateKeepClicked="Save a Site Duplicate Keep Clicked",r.SaveSiteDialogEditClicked="Save a Site Edit Clicked",r.SaveSiteDialogNewClicked="Save a Site New Clicked",r.SaveSiteDialogSelectClicked="Save a Site Select Clicked",r.SaveSiteDialogViewed="Save a Site Viewed",r.SaveSiteDialogAnotherClicked="Save a Site Another Clicked"}),r("common/enums/segment-event-type",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),(t.SegmentEventType||(t.SegmentEventType={})).SaveSiteDialog="savesitedialog"}),r("common/enums/service-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ServiceType||(t.ServiceType={})).BasicAuth="BasicAuth",r.ContentScriptTools="ContentScriptTools",r.DomUtils="DomUtils",r.FormDetection="FormDetection",r.AutoFill="AutoFill",r.FormParser="FormParser",r.Segment="Segment",r.Site="Site",r.StringUtils="StringUtils",r.Topic="Topic",r.WebRequest="WebRequest",r.WebRequestShim="WebRequestShim"}),r("common/enums/topic-type",["require","exports","common/legacy"],function(e,t,r){var o;Object.defineProperty(t,"__esModule",{value:!0}),(o=t.TopicType||(t.TopicType={}))[o.ClearData=r.LegacyGlobalCommon.Topics.CLEAR_DATA]="ClearData",o[o.FilledGeneratedPassword=r.LegacyGlobalCommon.Topics.FILLED_GENERATED_PW]="FilledGeneratedPassword",o[o.Initialized=r.LegacyGlobalCommon.Topics.INITIALIZED]="Initialized",o[o.Login=r.LegacyGlobalCommon.Topics.LOGIN]="Login",o[o.LoginFinished=r.LegacyGlobalCommon.Topics.LOGIN_FINISHED]="LoginFinished",o[o.ProcessedFormSubmit=r.LegacyGlobalCommon.Topics.PROCESSED_FORM_SUBMIT]="ProcessedFormSubmit",o[o.RequestFrameworkInitialized=r.LegacyGlobalCommon.Topics.REQUEST_FRAMEWORK_INITIALIZED]="RequestFrameworkInitialized",o[o.PasswordFormSubmitted=r.LegacyGlobalCommon.Topics.PASSWORD_FORM_SUBMITTED]="PasswordFormSubmitted"}),r("common/enums/index",["require","exports","common/enums/auto-fill-action","common/enums/auto-fill-input-category","common/enums/auto-fill-method","common/enums/feature-type","common/enums/repository-type","common/enums/resolver-type","common/enums/save-site-action","common/enums/save-site-event-type","common/enums/segment-event-type","common/enums/service-type","common/enums/topic-type"],function(e,t,r,o,i,n,s,a,u,c,l,d,p){function f(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),f(r),f(o),f(i),f(n),f(s),f(a),f(u),f(c),f(l),f(d),f(p)}),r("common/repositories/auto-fill-state/auto-fill-algorithm-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-frame-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-state",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.tabId=e,this.url=t,this.frames={}}return Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){var r=e.frames[t];return r.isReady||!r.isAllowed})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllowed",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){return e.frames[t].isAllowed})},enumerable:!0,configurable:!0}),e.prototype.tryGetFrame=function(e){return this.frames[e]||(this.frames[e]=this.getEmptyFrame()),this.frames[e]},e.prototype.getEmptyFrame=function(){return{elements:{},isAllowed:!0,isReady:!1}},e.prototype.setFrameAllowed=function(e,t){this.tryGetFrame(e).isAllowed=t},e.prototype.setFrameReady=function(e,t){this.tryGetFrame(e).isReady=t},e.prototype.getFrameAlgorithmState=function(e,t,r){var o=this.tryGetFrame(e);if(o.elements[t])return o.elements[t][r]},e.prototype.setFrameAlgorithmState=function(e,t,r,o){var i=this.tryGetFrame(e),s=i.elements[t];s||(s={},i.elements[t]=s),i.elements[t][r]=n({},s[r],o)},e.prototype.resetFrameState=function(e){this.frames[e]&&(this.frames[e]=this.getEmptyFrame())},e.prototype.deleteFrameState=function(e){this.frames[e]&&delete this.frames[e]},e.prototype.getResults=function(){var e=this,t={count:0};Object.keys(r.AutoFillAlgorithm).forEach(function(e){t[e]=0});var o={allowed:this.isAllowed,userName:n({},t),password:n({},t)};return Object.keys(this.frames).forEach(function(i){var s=e.frames[i];s.isAllowed&&s.isReady&&Object.keys(s.elements).forEach(function(e){return Object.keys(s.elements[e]).forEach(function(i){var a=s.elements[e][i].filledWith;if(a&&"none"!==a){o[a]||(o[a]=n({},t));var u=o[a][i]+1;i===r.AutoFillAlgorithm.Legacy&&(o[a].count=u),o[a][i]=u}})})}),o},e}();t.AutoFillState=o}),r("common/repositories/auto-fill-state/index",["require","exports","common/repositories/auto-fill-state/auto-fill-state"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}),r("common/interfaces/auto-fill-state.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/auto-fill.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/feature.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/segment.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/segment-event",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-callback",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-value",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request-shim.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/content-script-target",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/services/form-parser/form-meta-data",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.passwordsByValue={},this.textFieldsByValue={},this.textFieldsByType={},this.uniqueTextValues=[],this.uniquePasswords=[],e.fields&&(e.fields.forEach(function(e){"password"===e.type?t.aggregateField(e,e.value,t.passwordsByValue):(t.aggregateField(e,e.value,t.textFieldsByValue),t.aggregateField(e,e.type,t.textFieldsByType))}),this.uniqueTextValues=Object.keys(this.textFieldsByValue),this.uniquePasswords=Object.keys(this.passwordsByValue))}return e.prototype.aggregateField=function(e,t,r){var o=r[t];o?++o.count:r[t]={field:e,count:1}},e}();t.FormMetaData=r}),r("background/interfaces/parsed-form",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyGlobalCommon=o}),r("common/module.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._isInitialized=!1,this.initializedQueue=[],setTimeout(function(){return s(e,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.initialize()];case 1:return e.sent(),[4,this.postInitialize()];case 2:for(e.sent(),this._isInitialized=!0;this.initializedQueue.length;)try{this.initializedQueue.pop()()}catch(e){console.error(e)}return[2]}})})})}return e.prototype.isInitialized=function(e){this._isInitialized?e():this.initializedQueue.push(e)},e}();t.ModuleAbstract=r}),r("common/provider.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=!0);var r=this;this.instances={},this.initialized=!1,e&&e.size&&(this.map=e,this.map.forEach(function(e,o){e.delegated&&!t||(r.instances[o]=new e.ctor)}))}return e.prototype.initialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){return e.instances[t].initialize()}),this.initialized=!0},e.prototype.postInitialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){"function"==typeof e.instances[t].postInitialize&&e.instances[t].postInitialize()})},e.prototype.teardown=function(){var e=this;Object.keys(this.instances).forEach(function(t){e.instances[t]&&"function"==typeof e.instances[t].destroy&&e.instances[t].destroy()})},e}();t.ProviderAbstract=r}),r("common/decorators/register-repository.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterRepository=function(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}},t.getRepositoryRegistry=function(){return r}}),r("common/decorators/register-service.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterService=function(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}},t.getServiceRegistry=function(){return r}}),r("common/messaging/messaging",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap;t.addVisibleMethod=function(e,t){var o=e.constructor,i=r.get(o);i&&i.size?i.add(t):i=new Set([t]),r.set(o,i)};var o=null;function i(e,t){if("function"==typeof t){var r=void 0;"string"==typeof e?r=e:e instanceof Error&&(r="string"==typeof e.message?e.message:"function"==typeof e.toString?e.toString():"Unknown error"),t(r)}else console.error(e)}t.getInvokatingMessageContext=function(){return o},t.callMethod=function(e,t,n,u,c){return void 0===n&&(n=[]),s(this,void 0,void 0,function(){var s,l;return a(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,4,5]),!e||!e.constructor)throw new Error("No target provided!");if(!r.has(e.constructor))throw new Error("Target has no visible methods.");if(!r.get(e.constructor).has(t))throw new Error("Method [ "+t+" ] is not a visible method.");if("function"!=typeof(s=e[t]))throw new Error("Method [ "+t+" ] is not a function or does not exist on the target.");return o=Object.freeze({calleeTab:Object.freeze(c)}),(l=s.bind(e).apply(void 0,n))&&"function"==typeof l.then?[4,l]:[3,2];case 1:l=a.sent(),a.label=2;case 2:return u(null,l),[3,5];case 3:return i(a.sent(),u),[3,5];case 4:return o=null,[7];case 5:return[2]}})})},t.handleCallbackError=i}),r("common/decorators/visible.decorator",["require","exports","common/messaging/messaging"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visible=function(e,t,o){r.addVisibleMethod(e,t)}}),r("common/decorators/index",["require","exports","common/decorators/register-repository.decorator","common/decorators/register-service.decorator","common/decorators/visible.decorator"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),r("common/interfaces/site.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/services/topic/topic.service",["require","exports","common/decorators/index","common/enums/index","common/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.subscribe=function(e,t){i.LegacyGlobalCommon.Topics.get(e).subscribe(function(e){return t(e)})},e=u([r.RegisterService(o.ServiceType.Topic)],e)}();t.TopicService=n}),r("common/services/utils/string-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;++r)if(e.indexOf(t[r])>-1)return!0}return!1},e.prototype.containsMaskingCharacter=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1},e=u([r.RegisterService(o.ServiceType.StringUtils)],e)}();t.StringUtilsService=i}),r("background/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyGlobal=o}),r("background/repositories/auto-fill-state/auto-fill-state.repository",["require","exports","common/decorators/index","common/enums/index","common/repositories/auto-fill-state/index","background/legacy"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.states=new Map}return e.prototype.tryGetState=function(e){var t;try{t=this.getState(e)}catch(e){if(!(e instanceof ReferenceError))throw e}if(!t){var r=n.LegacyGlobal.LPTabs.get({tabID:e}),o=void 0;r&&(o=r.tabDetails.tabURL),t=new i.AutoFillState(e,o),this.setState(t)}return t},e.prototype.initialize=function(){},e.prototype.getState=function(e,t){var r=this.states.get(e);if(!r){var o="Could not find state for tab: "+e;if("function"==typeof t)return void t(o);throw new ReferenceError(o)}if("function"!=typeof t)return r;t(null,r)},e.prototype.setState=function(e){this.states.set(e.tabId,e)},e.prototype.deleteState=function(e){this.states.delete(e)},e.prototype.resetFrameState=function(e,t){this.states.has(e)&&this.states.get(e).resetFrameState(t)},e.prototype.deleteFrameState=function(e,t){this.states.has(e)&&this.states.get(e).deleteFrameState(t)},e.prototype.getFrameAlgorithmState=function(e,t,r,o,i){var n;try{var s=this.getState(e);n=s.getFrameAlgorithmState(t,r,o)}catch(e){if(!(e instanceof ReferenceError))throw e;n={}}if("function"!=typeof i)return n;i(null,n)},e.prototype.setFrameAlgorithmState=function(e,t,r,o,i){this.tryGetState(e).setFrameAlgorithmState(t,r,o,i)},e.prototype.setFrameAllowed=function(e,t,r){this.tryGetState(e).setFrameAllowed(t,r)},e.prototype.setFrameReady=function(e,t,r){this.tryGetState(e).setFrameReady(t,r)},e.prototype.getFillResults=function(e,t,r){var o;t=t||0;try{var i=this.getState(e);o=i.getResults()}catch(e){o={}}if("function"!=typeof r)return o;r(null,o)},u([r.Visible],e.prototype,"getState",null),u([r.Visible],e.prototype,"setState",null),u([r.Visible],e.prototype,"deleteState",null),u([r.Visible],e.prototype,"resetFrameState",null),u([r.Visible],e.prototype,"deleteFrameState",null),u([r.Visible],e.prototype,"getFrameAlgorithmState",null),u([r.Visible],e.prototype,"setFrameAlgorithmState",null),u([r.Visible],e.prototype,"setFrameAllowed",null),u([r.Visible],e.prototype,"setFrameReady",null),u([r.Visible],e.prototype,"getFillResults",null),e=u([r.RegisterRepository(o.RepositoryType.AutoFillState)],e)}();t.AutoFillStateRepository=s}),r("background/repositories/feature/feature.repository",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.featureEnumNames=new Set,this.featurePropertyNames=new Set,Object.keys(o.FeatureType).forEach(function(t){e.featureEnumNames.add(t),e.featurePropertyNames.add(o.FeatureType[t])})}return e.prototype.initialize=function(){},e.prototype.get=function(e){return i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]},e.prototype.set=function(e,t){i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]=t},e.prototype.resolvePropertyName=function(e){if(this.featureEnumNames.has(e))return o.FeatureType[e];if(this.featurePropertyNames.has(e))return e;throw new TypeError("Unrecognized feature name: [ "+e+" ]")},u([r.Visible],e.prototype,"get",null),u([r.Visible],e.prototype,"set",null),e=u([r.RegisterRepository(o.RepositoryType.Feature)],e)}();t.FeatureRepository=n}),r("background/repositories/repository-provider",["require","exports","common/provider.abstract","common/messaging/messaging"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.getRepository=function(e){return this.instances[e]},t.prototype.call=function(e,t,r,i,n){void 0===r&&(r=[]);try{o.callMethod(this.getRepository(e),t,r,i,n)}catch(e){o.handleCallbackError(e,i)}},t}(r.ProviderAbstract);t.RepositoryProvider=i}),r("background/repositories/index",["require","exports","background/repositories/auto-fill-state/auto-fill-state.repository","background/repositories/feature/feature.repository","background/repositories/repository-provider"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),r("background/services/service-provider",["require","exports","common/provider.abstract","common/enums/index","common/messaging/messaging","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.getService=function(e,t){var r=this.map.get(e);if(!r)return null;var o=r.delegated;if(!t&&o)throw new Error("Must provide a target for delegated service [ "+e+" ]");if(t&&!o)throw new Error("Target not supported for non-delegated service [ "+e+" ]");return o?new r.ctor(t):this.instances[e]},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this),window.basicAuth=this.getService(o.ServiceType.BasicAuth)},t.prototype.call=function(e,t,r,o,n){void 0===r&&(r=[]);try{i.callMethod(this.getService(e),t,r,o,n)}catch(e){i.handleCallbackError(e,o)}},t}(r.ProviderAbstract);t.ServiceProvider=s,t.callContentScriptService=function(e,t,r,o,s){n.getContentScriptInterfaces(e).then(function(e){return e.forEach(function(e){if("function"!=typeof s)return new Promise(function(i,n){e.LPModule.callService(t,r,o,function(e,t){return e?n(e):i(t)})});e.LPModule.callService(t,r,o,s)})}).catch(function(e){i.handleCallbackError(e,s)})}}),r("background/services/auto-fill/delegated-auto-fill.service",["require","exports","common/decorators/index","common/enums/index","background/services/service-provider"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.target=e}return e.prototype.initialize=function(){},e.prototype.fill=function(e){return s(this,void 0,void 0,function(){return a(this,function(t){return i.callContentScriptService(this.target,o.ServiceType.AutoFill,"fill",[e]),[2]})})},e=u([r.RegisterService(o.ServiceType.AutoFill,!0)],e)}();t.DelegatedAutoFillService=n}),r("background/services/basic-auth/auth-credential",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===o&&(o=!1),this.url=e,this.userName=t,this.password=r,this.suppliedBefore=o,this.cancelled=!1}}();t.AuthCredential=r}),r("background/services/basic-auth/basic-auth.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/basic-auth/auth-credential"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.authCredentials={}}return e.prototype.initialize=function(){this.subscribeEvents()},e.prototype.subscribeEvents=function(){var e=this;i.LegacyGlobal.LPPlatform.onAuthRequired(function(t,r){if(i.LegacyGlobal.g_basicauth_feature_enabled&&"basic"===t.scheme){var o=e.authCredentials[t.tabId];if(o&&!o.cancelled&&!o.suppliedBefore)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url,o.userName,o.password,!0),e.removeAuth(r),{authCredentials:{username:o.userName,password:o.password}};if(!o)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url),{cancel:!0}}}),i.LegacyGlobal.LPPlatform.onTabClosed(function(t){e.removeAuth(t)})},e.prototype.removeAuth=function(e){this.authCredentials[e]&&delete this.authCredentials[e]},e.prototype.isBasicAuth=function(e,t){var r=!1,o=!1;if(t&&t.tabID){var i=this.authCredentials[t.tabID];i&&(i.url!==t.tabURL?this.removeAuth(t.tabID):i.cancelled||(r=!0,o=i.suppliedBefore))}e(r,o)},e.prototype.setAuthCredential=function(e,t,r,o){var i=this.authCredentials[o.tabID];i.userName=e,i.password=t,r()},e.prototype.cancelBasicAuth=function(e){this.authCredentials[e.tabID]&&(this.authCredentials[e.tabID].cancelled=!0)},e.prototype.hasFeature=function(e){e(!0)},e.prototype.isNotificationClosed=function(e){e("closed"===i.LegacyGlobal.localStorage_getItem("basicAuthPopupState"))},e.prototype.closeNotification=function(){i.LegacyGlobal.localStorage_setItem("basicAuthPopupState","closed")},e=u([r.RegisterService(o.ServiceType.BasicAuth)],e)}();t.BasicAuthService=s}),r("background/services/form-parser/field-parsers/field-parser.abstract",["require","exports","background/legacy"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.operations=[]}return e.regexMatches=function(e,t){var r=!1;if(e){var o=function(e,t){return"string"==typeof t&&e.test(t.toLowerCase())};Array.isArray(t)?t.forEach(function(t){return r=r||o(e,t)}):r=o(e,t)}return r},e.getFormFieldRegex=function(e){var t=r.LegacyGlobal.get_ff_translation(e);if(t)return new RegExp(t)},e.prototype.parse=function(e,t){for(var r=null,o=0,i=this.operations;o<i.length;o++){if((r=(0,i[o])(e,t))||!1===r)break}return r},e}();t.FieldParserAbstract=o}),r("background/services/form-parser/field-parsers/password-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var n=e.call(this)||this;return n.stringUtils=i.getService(o.ServiceType.StringUtils),n.siteService=i.getService(o.ServiceType.Site),t.excludedFields.length||(t.excludedFields=[{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_ssn_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_cccsc_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_securityanswer_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_captcha_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_ssn_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_cccsc_regexp")}]),n.operations=[n.excludedFieldOperation,n.singlePasswordFieldOperation,n.multiplePasswordOperation,n.multiplePasswordsOneExistingOperation,n.passwordLikeAttribute],n.operations=n.operations.map(function(e){return e.bind(n)}),n}return c(t,e),t.prototype.excludedFieldOperation=function(e,o){for(var i=0;i<e.fields.length;++i)for(var n=e.fields[i],s=0;s<t.excludedFields.length;++s){var a=t.excludedFields[s];if(a.regex){if("attr"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,[n.id,n.attributes.name]))return!1;if("text"===a.type&&r.FieldParserAbstract.regexMatches(a.regex,n.label))return!1}}return null},t.prototype.singlePasswordFieldOperation=function(e,t){if(1===t.uniquePasswords.length){var r=t.uniquePasswords[0];return 2===t.passwordsByValue[r].count&&(2===e.fields.length?e.passwordChangeForm=!0:e.createAccountForm=!0),r}return null},t.prototype.multiplePasswordOperation=function(e,t){for(var r=0,o=t.uniquePasswords;r<o.length;r++){var i=o[r];if(t.passwordsByValue[i].count>1)return 2===t.uniquePasswords.length?(e.passwordChangeForm=!0,e.originalPassword=t.uniquePasswords[0]===i?t.uniquePasswords[1]:t.uniquePasswords[0]):e.createAccountForm=!0,i}return null},t.prototype.multiplePasswordsOneExistingOperation=function(e,t){if(2===t.uniquePasswords.length){var r=this.findMatchingPassword(this.siteService.getSites(e.url),t.uniquePasswords);if(r)return e.passwordChangeForm=!0,e.originalPassword=r,t.uniquePasswords[0]===r?t.uniquePasswords[1]:t.uniquePasswords[0]}return null},t.prototype.passwordLikeAttribute=function(e,t){for(var r=0,o=t.uniquePasswords;r<o.length;r++){var i=o[r],n=t.passwordsByValue[i].field,s=["pw","pass"];if(this.stringUtils.stringContains(n.attributes.name,s)||this.stringUtils.stringContains(n.id,s))return i}},t.prototype.findMatchingPassword=function(e,t){for(var r=0;r<e.length;++r){var o=this.siteService.findMatchingSitePassword(e[r],t);if(o)return o}return null},t.excludedFields=[],t}(r.FieldParserAbstract);t.PasswordFieldParser=n}),r("background/services/form-parser/field-parsers/user-name-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/service-type","background/legacy","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var i=e.call(this)||this;return i.isStrict=t,i.userNameRegEx=r.FieldParserAbstract.getFormFieldRegex("ff_username_regexp"),i.stringUtils=n.getService(o.ServiceType.StringUtils),i.isStrict?i.operations=[i.userNameLikeLabelOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation]:i.operations=[i.userNameLikeLabelOperation,i.singleTextFieldOperation,i.multipleTextFieldOperation,i.nearPasswordFieldOpeartion,i.existingUserNameOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation],i.operations=i.operations.map(function(e){return e.bind(i)}),i}return c(t,e),t.prototype.userNameLikeLabelOperation=function(e,t){if(this.userNameRegEx)for(var o=0,i=e.fields;o<i.length;o++){var n=i[o];if(r.FieldParserAbstract.regexMatches(this.userNameRegEx,n.label))return n.value}return null},t.prototype.userNameLikeAttributeOperation=function(e,t){for(var r=0,o=t.uniqueTextValues;r<o.length;r++){var i=o[r],n=t.textFieldsByValue[i].field;if(this.stringUtils.stringContains(n.attributes.name,"user")||this.stringUtils.stringContains(n.id,"user"))return i}return null},t.prototype.singleTextFieldOperation=function(e,t){if(1===t.uniqueTextValues.length){var r=t.uniqueTextValues[0];return 2===t.textFieldsByValue[r].count&&(e.createAccountForm=!0),r}return null},t.prototype.multipleTextFieldOperation=function(e,t){for(var r=0,o=t.uniqueTextValues;r<o.length;r++){var i=o[r];if(t.textFieldsByValue[i].count>1)return e.createAccountForm=!0,i}return null},t.prototype.nearPasswordFieldOpeartion=function(e,t){for(var r=e.fields,o=1;o<r.length;++o){if("password"===r[o].type){var i=r[o-1];if("password"!==i.type)return i.value}}return null},t.prototype.existingUserNameOperation=function(e,t){for(var r in i.LegacyGlobal.g_sites)if(t.uniqueTextValues.indexOf(i.LegacyGlobal.g_sites[r].unencryptedUsername)>-1)return i.LegacyGlobal.g_sites[r].unencryptedUsername;return null},t.prototype.uniqueEmailFieldOperation=function(e,r){for(var o=[],i=0,n=r.uniqueTextValues;i<n.length;i++){var s=n[i],a=s.match(t.emailRegex);a&&1===a.length&&o.push(s)}return 1===o.length?o[0]:null},t.emailRegex=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/g,t}(r.FieldParserAbstract);t.UserNameFieldParser=s}),r("background/services/form-parser/field-parsers/index",["require","exports","background/services/form-parser/field-parsers/password-field-parser","background/services/form-parser/field-parsers/user-name-field-parser"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),r("background/services/form-parser/parsed-form",["require","exports","background/background.module","common/enums/index","background/services/form-parser/form-meta-data","background/services/form-parser/field-parsers/index"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.formProfile=null,this.userNameField=null,this.metaData=null,this._succeeded=!1,this._submitted=!1;var s=r.getService(o.ServiceType.Site);if(e.fields=e.fields||[],this.metaData=new i.FormMetaData(e),!e.password)if(e.generatedPassword)e.password=e.generatedPassword;else{var a=(new n.PasswordFieldParser).parse(e,this.metaData);"string"==typeof a&&(e.password=a)}var u=new n.UserNameFieldParser(t&&t.strict).parse(e,this.metaData),c=[];"string"==typeof u&&(c=s.getSites(e.url).filter(function(e){return s.hasMatchingSiteUserName(e,u)}),e.username&&0===c.length&&!e.createAccountForm||(e.username=u));if(e.username&&!e.createAccountForm)for(var l=0,d=e.fields;l<d.length;l++){var p=d[l];if(p.value===e.username){this.userNameField=p;break}}this.formProfile=e,this._submitted=!e.generatedPassword}return e.prototype.submitted=function(e){return"boolean"==typeof e&&(this._submitted=e),this._submitted},e.prototype.succeeded=function(e){return"boolean"==typeof e&&(this._succeeded=e),this._succeeded},e.prototype.getUsernameField=function(){return this.userNameField},e.prototype.getUsername=function(){return this.formProfile.username},e.prototype.getPassword=function(){return this.formProfile.password},e.prototype.getOriginalPassword=function(){return this.formProfile.originalPassword},e.prototype.getFormProfile=function(){return this.formProfile},e.prototype.getFormMetaData=function(){return this.metaData},e.prototype.getFields=function(){return this.formProfile.fields},e.prototype.isChangePasswordForm=function(){return!!this.formProfile.passwordChangeForm},e.prototype.isCreateAccountForm=function(){return!!this.formProfile.passwordChangeForm||!!this.formProfile.generatedPassword},e.prototype.isBasicAuthentication=function(){return!!this.formProfile.basicAuthentication},e.prototype.shouldSaveFields=function(){return!this.isChangePasswordForm()&&!this.isCreateAccountForm()},e.prototype.getURL=function(){return this.formProfile.url},e}();t.ParsedForm=s}),r("background/services/form-parser/form-parser.service",["require","exports","common/decorators/index","common/enums/index","background/services/form-parser/parsed-form"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.parse=function(e,t){return new i.ParsedForm(e,t)},e=u([r.RegisterService(o.ServiceType.FormParser)],e)}();t.FormParserService=n}),r("background/services/segment/events/save-site-dialog",["require","exports","common/enums/index","background/legacy","common/enums/save-site-action"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){if(this.sourceTabId=e,this.properties=t,this.type=r.SegmentEventType.SaveSiteDialog,!e||"number"!=typeof e)throw new TypeError("Missing a valid source tab ID.");if(!t)throw new TypeError('Missing "properties" argument.');if(!t.saveSiteEvent)throw new TypeError('Missing "saveSiteEvent" property.');if(!t.defaultData||void 0===t.matchingSites)throw new TypeError("Unable to retrieve necessary site data from properties.");if(t.saveSiteEvent===r.SaveSiteDialogEventType.SaveSiteDialogAction)throw new TypeError("Action argument required for SaveSiteDialogAction events.")}return e.prototype.getProperties=function(){return s(this,void 0,void 0,function(){var e,t;return a(this,function(o){switch(o.label){case 0:return[4,this.getTabState(this.sourceTabId)];case 1:return e=o.sent(),t=this.getCommonProperties(e,this.properties),[2,n({},t,{Action:i.SaveSiteAction[this.properties.action],saveSiteEvent:r.SaveSiteDialogEventType[this.properties.saveSiteEvent]})]}})})},e.prototype.getCommonProperties=function(e,t){var r=t.sameDomain,o=t.generatedPassword,i=this.getViewState();return{"Domain Sites":this.getDomainSites(e),"Matching Sites":this.getMatchingSites(e),Domain:this.getDomain(e,t),"Domain Changed":!r,"Generated Password":o,"View State":i}},e.prototype.getTabState=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){return o.LegacyGlobal.LPTabState.getStateByTabId(e,t)})];case 1:return(t=r.sent())?[2,t]:[2,null]}})})},e.prototype.getViewState=function(){var e=this.properties,t=e.matchingSites,r=e.generatedPassword,o=e.sameDomain,i=e.dialogData;if(!t)return"Unknown";switch(t.length){case 0:return r&&o&&i&&!i.preSubmit?"Add Auto":"Add";case 1:return r&&o&&i&&!i.preSubmit?"Update Auto":"Update";default:return"Update Select"}},e.prototype.getMatchingSites=function(e){var t=this.properties,r=t.matchingSites,o=t.defaultData,i=e.getMatchingSites(),n=o.unencryptedUsername;return null===n||void 0===n?0:i&&void 0!==i.length?i.length:r?r.length:0},e.prototype.getDomainSites=function(e){var t=this.properties.defaultData,r=e.getSites();return r&&void 0!==r.length?r.length:t&&void 0!==t.domainSites?t.domainSites.length:0},e.prototype.getDomain=function(e,t){var r=t.defaultData;return t.sameDomain?e.domain:o.LegacyGlobal.lp_gettld_url(r.url)},e}();t.SaveSiteDialogEvent=u}),r("background/services/segment/events/event.factory",["require","exports","background/services/segment/events/index","common/enums/index"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createSegmentEvent=function(e,t,i){return s(this,void 0,void 0,function(){var n,s,u;return a(this,function(a){switch(a.label){case 0:switch(s="properties",e){case o.SegmentEventType.SaveSiteDialog:s="saveSiteDialogProperties",n=new r.SaveSiteDialogEvent(t,i);break;default:throw new Error("Unsupported Segment Event type: "+e)}return[4,n.getProperties()];case 1:return u=a.sent(),[2,[s,u]]}})})}}),r("background/services/segment/events/index",["require","exports","background/services/segment/events/save-site-dialog","background/services/segment/events/event.factory"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),r("background/services/segment/segment.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/segment/events/index","common/messaging/messaging"],function(e,t,r,o,i,n,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){i.LegacyGlobal.sendLpImprove(e,t)},e.prototype.sendTypedEvent=function(e,t){return s(this,void 0,void 0,function(){var r,i,s,u,l,d;return a(this,function(a){switch(a.label){case 0:return i=o.SegmentEventType[e],console.assert(i,"Segment event "+e+" is not a valid event!"),i?(s=c.getInvokatingMessageContext(),[4,n.createSegmentEvent(i,s.calleeTab.tabID,t)]):[3,2];case 1:u=a.sent(),l=u[0],(d=u[1])&&this.send(i,((r={})[l]=JSON.stringify(d),r)),a.label=2;case 2:return[2]}})})},u([r.Visible],e.prototype,"sendTypedEvent",null),e=u([r.RegisterService(o.ServiceType.Segment)],e)}();t.SegmentService=l}),r("background/services/site/site.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.siteGroups=new Map}return e.prototype.initialize=function(){this.stringUtils=n.getService(o.ServiceType.StringUtils)},e.prototype.getSites=function(e){var t=i.LegacyGlobal.lp_gettld_url(e),r=this.siteGroups.get(e)||{accountsVersion:NaN,sites:[]};return r.accountsVersion!==i.LegacyGlobal.g_local_accts_version&&(r.accountsVersion=i.LegacyGlobal.g_local_accts_version,r.sites=i.LegacyGlobal.reorderOnURL(i.LegacyGlobal.getsites(t),e),this.siteGroups.set(e,r)),r.sites},e.prototype.findSites=function(e,t,r){var o=this;return this.getSites(e).filter(function(e){return o.hasMatchingSiteUserName(e,t)}).filter(function(e){return o.findMatchingSitePassword(e,r)})},e.prototype.getMatchingSites=function(e,t,r){var o=this,i=this.getSites(e);if(i.length>0){if(t)return i.filter(function(e){return o.hasMatchingSiteUserName(e,t)});if(r)return i.filter(function(e){return o.findMatchingSitePassword(e,r)})}return i},e.prototype.getUserNames=function(e){return this.getSites(e).map(function(e){return e.unencryptedUsername})},e.prototype.decrypt=function(e,t){return i.LegacyGlobal.lpmdec_acct(t,!0,e,i.LegacyGlobal.g_shares)},e.prototype.findMatchingSitePassword=function(e,t){Array.isArray(t)||(t=[t]);var r=t.indexOf(this.decrypt(e,e.password));if(-1===r&&e.fields&&e.fields.length>0)for(var o=0;o<e.fields.length;++o){var i=e.fields[o];if("password"===i.type&&(r=t.indexOf(this.decrypt(e,i.value)))>-1)break}return r>-1?t[r]:null},e.prototype.hasMatchingSiteUserName=function(e,t){if(!t)return!1;if(this.userNamesMatch(e.unencryptedUsername,t))return!0;if(e.fields&&e.fields.length)for(var r=0,o=e.fields;r<o.length;r++){var i=o[r];switch(i.type){case"text":case"email":case"tel":if(this.userNamesMatch(this.decrypt(e,i.value),t))return!0}}return!1},e.prototype.userNamesMatch=function(e,t){return e===t||this.userNameInEmail(e,t)||this.userNameInEmail(t,e)||this.isMaskedUsername(e,t)},e.prototype.userNameInEmail=function(e,t){if(t&&t.indexOf("@")>-1){var r=t.split("@");return 2===r.length&&e===r[0]}return!1},e.prototype.isMaskedUsername=function(e,t){return!!this.stringUtils.containsMaskingCharacter(t)&&(e.length===t.length&&(e[0]===t[0]||e[e.length-1]===t[t.length-1]))},u([r.Visible],e.prototype,"getUserNames",null),e=u([r.RegisterService(o.ServiceType.Site)],e)}();t.SiteService=s}),r("background/services/web-request/web-request-shim.service",["require","exports","common/decorators/index","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){var e=this;this.webRequest=i.getService(o.ServiceType.WebRequest);var t=i.getService(o.ServiceType.Topic);t.subscribe(o.TopicType.LoginFinished,function(){e.webRequest.isEnabled()&&(t.subscribe(o.TopicType.ProcessedFormSubmit,function(t){var r=t.password,o=t.tabId,i=t.inputValues;r&&e.handleOnBefore(o,i,"NONE")}),t.subscribe(o.TopicType.PasswordFormSubmitted,function(t){var r=t.form,o=t.tabId;r&&e.handleOnCompleted(o,"NONE",200)}))})},e.prototype.handleOnBefore=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.addRequest({requestBody:{formData:{inputValues:t}},requestId:r,tabId:e,method:void 0,url:void 0,timeStamp:void 0,frameId:void 0,parentFrameId:void 0,type:void 0})},e.prototype.handleOnCompleted=function(e,t,r){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r})},e.prototype.handleOnError=function(e,t,r,o){this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r,error:o})},u([r.Visible],e.prototype,"handleOnBefore",null),u([r.Visible],e.prototype,"handleOnCompleted",null),u([r.Visible],e.prototype,"handleOnError",null),e=u([r.RegisterService(o.ServiceType.WebRequestShim)],e)}();t.WebRequestShimService=n}),r("background/services/web-request/request-resolvers/request-resolver.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.type=e}return Object.defineProperty(e.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),e}();t.RequestResolverAbstract=r}),r("background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract",["require","exports","background/services/web-request/request-resolvers/request-resolver.abstract","background/legacy","background/services/form-parser/parsed-form","background/background.module","common/enums/index"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var r=e.call(this,t)||this;return r.siteService=n.getService(s.ServiceType.Site),r}return c(t,e),t.prototype.sendSegmentEvent=function(e,t,r){e.send("passwordsubmitted",{type:r,passwordSubmittedProperties:JSON.stringify(this.getPasswordSubmittedProperties(t))})},t.prototype.getPasswordSubmittedProperties=function(e){var t=new i.ParsedForm(e),r=e.fields.filter(function(e){return"password"===e.type}).some(function(t){return t.value===e.generatedPassword}),n=this.siteService.getMatchingSites(e.url,e.username).length;return{"Domain Sites":this.siteService.getSites(e.url).length,"Matching Sites":n,"Generated Password":r,"Input Counts":this.getInputCounts(t),"Password Changed":!!n&&this.isChangePassword(t),Settings:{"Show Save Site Notification Bar":o.LegacyGlobal.Preferences.get("showSaveNotificationBar"),"Show Change Notification Bar":o.LegacyGlobal.Preferences.get("showChangeNotificationBar"),"Never Add Site":o.LegacyGlobal.hasNeverSave(o.LegacyGlobal.g_currenturl,o.LegacyGlobal.lp_gettld_url(o.LegacyGlobal.g_currenturl))}}},t.prototype.getInputCounts=function(e){var t=e.getFormMetaData(),r=Object.keys(t.passwordsByValue).reduce(function(e,r){return e+t.passwordsByValue[r].count},0);return{Username:e.getUsername()?1:0,Password:r}},t.prototype.isChangePassword=function(e){var t=e.getFormProfile(),r=e.getPassword();if(t.currentPassword){if(t.originalPassword)return t.currentPassword!==t.originalPassword;if(this.siteService.getSites(t.url).length){var o=e.getUsername();if(o)return 0===this.siteService.findSites(t.url,o,t.originalPassword||r).length}}return!1},t}(r.RequestResolverAbstract);t.PasswordSubmittedRequestResolverAbstract=a}),r("background/services/web-request/request-resolvers/injected-password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.InjectedPasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return c(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"inject")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"inject",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.InjectedPasswordSubmittedResolver=n}),r("background/services/web-request/request-resolvers/password-submitted",["require","exports","background/services/web-request/request-resolvers/password-submitted-request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.PasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return c(t,e),t.prototype.resolveSuccess=function(t){e.prototype.sendSegmentEvent.call(this,this.segmentService,t,"webrequest")},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"webrequest",error:e,status:t})},t}(r.PasswordSubmittedRequestResolverAbstract);t.PasswordSubmittedResolver=n}),r("background/services/web-request/request-resolvers/index",["require","exports","background/services/web-request/request-resolvers/injected-password-submitted","background/services/web-request/request-resolvers/password-submitted"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),r("background/services/web-request/web-request.service",["require","exports","common/enums/index","common/decorators/index","background/legacy","background/background.module","background/services/web-request/request-resolvers/index"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){var e=this;this.requests={},this.trackedFormProfiles={},this.onBeforeRequestListener=function(t){e.shouldTrackRequest(t)&&(e.requests[e.getRequestKey(t.tabId,t.requestId)]=t)},this.onCompletedListener=function(t){var r=t.tabId,o=t.requestId,i=e.getTrackedFormProfile(e.getRequestKey(r,o));i&&e.requestResolvers[i.action].resolveSuccess(i.profile)},this.onErrorOccurredListener=function(t){var r=t.tabId,o=t.requestId,i=t.statusCode,n=t.error,s=e.getTrackedFormProfile(e.getRequestKey(r,o));s&&e.requestResolvers[s.action].resolveError(n,i)},"undefined"!=typeof browser?this.webRequestApi=browser.webRequest:"undefined"!=typeof chrome&&(this.webRequestApi=chrome.webRequest)}return e.prototype.trackFormSubmission=function(e,t){this.trackedFormProfiles[e]={profiles:t}},e.prototype.isApiSupported=function(){return!!this.webRequestApi&&this.features.get(r.FeatureType.WebRequestEnabled)&&!i.LegacyGlobal.g_isedge},e.prototype.isEnabled=function(){return this.features.get(r.FeatureType.PasswordSubmittedEvent)},e.prototype.addRequest=function(e){this.onBeforeRequestListener(e)},e.prototype.resolveRequest=function(e){var t=e.tabId,r=e.requestId,o=e.statusCode,i=e.error;i?this.onErrorOccurredListener({tabId:t,requestId:r,statusCode:o,error:i}):this.onCompletedListener({tabId:t,requestId:r,statusCode:o})},e.prototype.shouldTrackRequest=function(e){return e.requestBody&&!e.requestBody.error&&(e.requestBody.formData||e.requestBody.raw)&&!i.LegacyGlobal.hasNeverEnableLP(e.url,i.LegacyGlobal.lp_gettld_url(e.url))},e.prototype.takeRequest=function(e){var t=this;if(!this.requests[e])return null;var r=this.requests[e];if(r)delete this.requests[e];else{var o=this.parseRequestKey(e).tabId,i=[];Object.keys(this.requests).forEach(function(e){t.parseRequestKey(e).tabId===o&&(i.push(t.requests[e]),delete t.requests[e])}),i.length&&(r=i[0])}return r},e.prototype.requestHasFormData=function(e,t){return e.some(function(e){return e.fields.some(function(e){return""!==e.value&&-1!==t.indexOf(e.value)})})},e.prototype.getTrackedFormProfile=function(e){var t=this.takeRequest(e);if(!t)return null;var o=this.getSubmittedDataString(t),i=this.trackedFormProfiles[t.tabId];if(!(i&&i.profiles&&i.profiles.length&&o&&this.requestHasFormData(i.profiles,o)))return null;var n,s=null;if(o){if(!(s=i.profiles.filter(function(e){return e.fields.some(function(t){return!(!e.currentPassword||""===t.value)&&(t.value===e.currentPassword&&o.indexOf(t.value)>-1)})})[0]))return null;n=e.indexOf("NONE")>-1?r.ResolverType.InjectedPasswordSubmitted:r.ResolverType.PasswordSubmitted,delete this.trackedFormProfiles[t.tabId]}var a=this.parseRequestKey(e).tabId;return this.requestHasRecentlyResolved(a)?null:{profile:s,action:n}},e.prototype.requestHasRecentlyResolved=function(e){return this.didTabResolveLoginRequest(e,!0)},e.prototype.getSubmittedDataString=function(e){return e.requestBody?e.requestBody.formData?JSON.stringify(e.requestBody.formData):e.requestBody.raw.reduce(function(e,t){return e+String.fromCharCode.apply(null,new Uint8Array(t.bytes))},""):null},e.prototype.initialize=function(){var e=this;this.requestResolvers=this.setupRequestResolvers(),this.features=n.getRepository(r.RepositoryType.Feature);var t=n.getService(r.ServiceType.Topic);t.subscribe(r.TopicType.LoginFinished,function(){return e.setup()}),t.subscribe(r.TopicType.ClearData,function(){return e.teardown()}),i.LegacyGlobal.LPPlatform.onTabClosed(function(t){delete e.trackedFormProfiles[t],Object.keys(e.requests).forEach(function(r){return e.parseRequestKey(r).tabId===t&&delete e.requests[r]})})},e.prototype.destroy=function(){this.teardown()},e.prototype.setup=function(){if(this.isApiSupported()&&this.isEnabled()){var e={urls:["<all_urls>"],types:["xmlhttprequest","main_frame","sub_frame","other"]};this.webRequestApi.onBeforeRequest.addListener(this.onBeforeRequestListener,e,["requestBody"]),this.webRequestApi.onCompleted.addListener(this.onCompletedListener,e,null),this.webRequestApi.onErrorOccurred.addListener(this.onErrorOccurredListener,e)}},e.prototype.teardown=function(){this.isApiSupported()&&this.isEnabled()&&(this.webRequestApi.onBeforeRequest.removeListener(this.onBeforeRequestListener),this.webRequestApi.onCompleted.removeListener(this.onCompletedListener),this.webRequestApi.onErrorOccurred.removeListener(this.onErrorOccurredListener))},e.prototype.setupRequestResolvers=function(){var e=[];return e[r.ResolverType.PasswordSubmitted]=new s.PasswordSubmittedResolver,e[r.ResolverType.InjectedPasswordSubmitted]=new s.InjectedPasswordSubmittedResolver,e},e.prototype.getRequestKey=function(e,t){return t||(t="NONE"),e+"-"+t},e.prototype.parseRequestKey=function(e){var t=e.split("-"),r=t[0],o=t[1];return{tabId:parseInt(r,10),requestId:o}},e.prototype.getTabState=function(e){var t=i.LegacyGlobal.LPTabState.getStateByTabIdImmediate(e);return t||null},e.prototype.didTabResolveLoginRequest=function(e,t){var r=this.getTabState(e);if(!r)return!1;var o=r.getLoginRequestRecentlyResolved();return void 0!==t&&r.setLoginRequestRecentlyResolved(),o},u([o.Visible],e.prototype,"trackFormSubmission",null),u([o.Visible],e.prototype,"isApiSupported",null),u([o.Visible],e.prototype,"isEnabled",null),e=u([o.RegisterService(r.ServiceType.WebRequest)],e)}();t.WebRequestService=a}),r("background/services/index",["require","exports","background/services/auto-fill/delegated-auto-fill.service","background/services/basic-auth/basic-auth.service","background/services/form-parser/form-parser.service","background/services/segment/segment.service","background/services/service-provider","background/services/site/site.service","background/services/web-request/web-request-shim.service","background/services/web-request/web-request.service","common/services/topic/topic.service","common/services/utils/string-utils.service"],function(e,t,r,o,i,n,s,a,u,c,l,d){function p(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),p(r),p(o),p(i),p(n),p(s),p(a),p(u),p(c),p(l),p(d)}),r("background/background.module",["require","exports","background/repositories/index","background/services/index","common/decorators/index","common/module.abstract","background/legacy"],function(e,t,r,o,i,n,u){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return window.addEventListener("beforeunload",function(){t.serviceProvider.teardown(),t.repositoryProvider.teardown()}),t}return c(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.initialize=function(){return s(this,void 0,void 0,function(){return a(this,function(e){return this.repositoryProvider=new r.RepositoryProvider(i.getRepositoryRegistry()),this.serviceProvider=new o.ServiceProvider(i.getServiceRegistry()),this.repositoryProvider.initialize(),this.serviceProvider.initialize(),[2]})})},t.prototype.postInitialize=function(){return s(this,void 0,void 0,function(){return a(this,function(e){return this.repositoryProvider.postInitialize(),this.serviceProvider.postInitialize(),[2]})})},t.prototype.getServiceProvider=function(){return this.serviceProvider},t.prototype.getRepositoryProvider=function(){return this.repositoryProvider},t.prototype.getService=function(e){var t=this.serviceProvider.getService(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.prototype.getRepository=function(e){var t=this.repositoryProvider.getRepository(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.instance=null,t}(n.ModuleAbstract);t.getContentScriptInterfaces=function(e){return s(this,void 0,void 0,function(){var t,r,o;return a(this,function(i){if(t=[],e.interface)t.push(e.interface);else{if(!e.tabId)throw new TypeError("Invalid target provided.");if(!(r=u.LegacyGlobal.LPTabs.get({tabID:e.tabId})))throw new TypeError("No tab with id "+e.tabId+" found.");if(o=void 0,e.frameId&&"top"!==e.frameId){if("number"!=typeof e.frameId)throw new TypeError("Unsupported frame id value: "+e.frameId);o=r.getFrame(e.frameId)}else o=r.getTop();if(!o)throw new TypeError("No content script interface found for tab "+e.tabId);t.push(o)}return[2,t]})})},t.getService=function(e){return l.getInstance().getService(e)},t.getRepository=function(e){return l.getInstance().getRepository(e)},t.isInitialized=function(e){return l.getInstance().isInitialized(e)},t.callService=function(e,t,r,o,i){void 0===r&&(r=[]),l.getInstance().getServiceProvider().call(e,t,r,o,i)},t.callRepository=function(e,t,r,o,i){void 0===r&&(r=[]),l.getInstance().getRepositoryProvider().call(e,t,r,o,i)},t.default=l.getInstance()}),o.LPModule=t("background/background.module")}).call(this);
//# sourceMappingURL=sourcemaps/modules-background.js.map
