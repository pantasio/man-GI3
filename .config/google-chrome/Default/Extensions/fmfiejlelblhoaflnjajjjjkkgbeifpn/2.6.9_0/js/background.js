var engine={settings:{},defaultSettings:{useSSL:0,ip:"127.0.0.1",port:8080,path:"gui/",displayActiveTorrentCountIcon:1,showNotificationOnDownloadCompleate:1,notificationTimeout:5E3,backgroundUpdateInterval:12E4,popupUpdateInterval:1E3,login:null,password:null,hideSeedStatusItem:0,hideFnishStatusItem:0,showSpeedGraph:1,popupHeight:350,selectDownloadCategoryOnAddItemFromContextMenu:0,ctxMenuType:1,treeViewContextMenu:0,showDefaultFolderContextMenuItem:0,badgeColor:"0,0,0,0.40",showFreeSpace:1,fixCirilicTitle:0,
fixCirilicTorrentPath:0},torrentListColumnList:{},defaultTorrentListColumnList:[{column:"checkbox",display:1,order:0,width:19,lang:"selectAll"},{column:"name",display:1,order:1,width:200,lang:"OV_COL_NAME"},{column:"order",display:0,order:1,width:20,lang:"OV_COL_ORDER"},{column:"size",display:1,order:1,width:60,lang:"OV_COL_SIZE"},{column:"remaining",display:0,order:1,width:60,lang:"OV_COL_REMAINING"},{column:"done",display:1,order:1,width:70,lang:"OV_COL_DONE"},{column:"status",display:1,order:1,
width:70,lang:"OV_COL_STATUS"},{column:"seeds",display:0,order:1,width:30,lang:"OV_COL_SEEDS"},{column:"peers",display:0,order:1,width:30,lang:"OV_COL_PEERS"},{column:"seeds_peers",display:1,order:1,width:40,lang:"OV_COL_SEEDS_PEERS"},{column:"downspd",display:1,order:1,width:60,lang:"OV_COL_DOWNSPD"},{column:"upspd",display:1,order:1,width:60,lang:"OV_COL_UPSPD"},{column:"eta",display:1,order:1,width:70,lang:"OV_COL_ETA"},{column:"upped",display:0,order:1,width:60,lang:"OV_COL_UPPED"},{column:"downloaded",
display:0,order:1,width:60,lang:"OV_COL_DOWNLOADED"},{column:"shared",display:0,order:1,width:60,lang:"OV_COL_SHARED"},{column:"avail",display:0,order:1,width:60,lang:"OV_COL_AVAIL"},{column:"label",display:0,order:1,width:100,lang:"OV_COL_LABEL"},{column:"added",display:0,order:1,width:120,lang:"OV_COL_DATE_ADDED"},{column:"completed",display:0,order:1,width:120,lang:"OV_COL_DATE_COMPLETED"},{column:"actions",display:1,order:0,width:57,lang:"Actions"}],fileListColumnList:{},defaultFileListColumnList:[{column:"checkbox",
display:1,order:0,width:19,lang:"selectAll"},{column:"name",display:1,order:1,width:300,lang:"FI_COL_NAME"},{column:"size",display:1,order:1,width:60,lang:"FI_COL_SIZE"},{column:"downloaded",display:1,order:1,width:60,lang:"OV_COL_DOWNLOADED"},{column:"done",display:1,order:1,width:70,lang:"OV_COL_DONE"},{column:"prio",display:1,order:1,width:74,lang:"FI_COL_PRIO"}],icons:{complete:"images/notification_done.png",add:"images/notification_add.png",error:"images/notification_error.png"},capitalize:function(a){return a.substr(0,
1).toUpperCase()+a.substr(1)},varCache:{webUiUrl:void 0,token:void 0,cid:void 0,torrents:[],labels:[],settings:[],lastPublicStatus:"-_-",trafficList:[{name:"download",values:[]},{name:"upload",values:[]}],startTime:parseInt(Date.now()/1E3),activeCount:0,folderList:[],labelList:[]},param:function(a){if("string"===typeof a)return a;var d=[];a&&a.token&&(d.push(encodeURIComponent("token")+"="+encodeURIComponent(a.token)),delete a.token);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if(void 0===c||
null===c)a[b]="";if(Array.isArray(c))for(var e=0,g=c.length;e<g;e++)d.push(encodeURIComponent(b)+"="+encodeURIComponent(c[e]));else engine.settings.fixCirilicTorrentPath&&"path"===b&&void 0!==a.download_dir?d.push(encodeURIComponent(b)+"="+engine.inCp1251(c)):d.push(encodeURIComponent(b)+"="+encodeURIComponent(c))}return d.join("&")},publicStatus:function(a){engine.varCache.lastPublicStatus!==a&&(engine.varCache.lastPublicStatus=a,mono.sendMessage({setStatus:a}))},parseXhrHeader:function(a){a=a.split(/\r?\n/);
var d={};a.forEach(function(a){var c=a.indexOf(":");if(-1!==c){var b=a.substr(0,c).trim().toLowerCase();a=a.substr(c+1).trim();d[b]=a}});return d},request:function(a,d){var b={},c=function(a,b){c=null;k.timeoutTimer&&clearTimeout(k.timeoutTimer);var g=null;a&&(g=String(a.message||a)||"ERROR");a={statusCode:0,statusText:"",headers:{},body:""};if(l){a.statusCode=l.status;a.statusText=l.statusText;var f=null,e=l.getAllResponseHeaders();"string"===typeof e&&(f=engine.parseXhrHeader(e));a.headers=f||{};
a.body=b||""}d&&d(g,a,b)};"object"!==typeof a&&(a={url:a});var e=a.url,g=a.method||a.type||"GET";g=g.toUpperCase();var f=a.data,h=!1;"string"!==typeof f&&((h="[object FormData]"===String(f))||(f=engine.param(f)));f&&"GET"===g&&(e+=(/\?/.test(e)?"&":"?")+f,f=void 0);!1===a.cache&&-1!==["GET","HEAD"].indexOf(g)&&(e+=(/\?/.test(e)?"&":"?")+"_="+Date.now());a.headers=a.headers||{};f&&!h&&(a.headers["Content-Type"]=a.contentType||a.headers["Content-Type"]||"application/x-www-form-urlencoded; charset=UTF-8");
var k={};k.url=e;k.method=g;f&&(k.data=f);a.json&&(k.json=!0);a.xml&&(k.xml=!0);a.timeout&&(k.timeout=a.timeout);a.mimeType&&(k.mimeType=a.mimeType);a.withCredentials&&(k.withCredentials=!0);Object.keys(a.headers).length&&(k.headers=a.headers);0<k.timeout&&(k.timeoutTimer=setTimeout(function(){c&&c(Error("ETIMEDOUT"));l.abort()},k.timeout));var m={0:200,1223:204},l=new XMLHttpRequest;l.open(k.method,k.url,!0);k.mimeType&&l.overrideMimeType(k.mimeType);k.withCredentials&&(l.withCredentials=!0);for(var n in k.headers)l.setRequestHeader(n,
k.headers[n]);l.onload=function(){var a=m[l.status]||l.status;try{if(200<=a&&300>a||304===a){var b=l.responseText;if(k.json)b=JSON.parse(b);else if(k.xml)b=(new DOMParser).parseFromString(b,"text/xml");else if("string"!==typeof b)throw console.error("Response is not string!",b),Error("Response is not string!");return c&&c(null,b)}throw Error(l.status+" "+l.statusText);}catch(r){return c&&c(r)}};var t=l.onerror=function(){c&&c(Error(l.status+" "+l.statusText))};a=null;void 0!==l.onabort?l.onabort=
t:a=function(){4===l.readyState&&c&&setTimeout(function(){return t()})};a&&(l.onreadystatechange=a);try{l.send(k.data||null)}catch(q){setTimeout(function(){c&&c(q)})}b.abort=function(){c=null;l.abort()};return b},timer:{timer:null,state:0,start:function(){this.state=1;this.timer&&clearInterval(this.timer);this.timer=null;1E3>=engine.settings.backgroundUpdateInterval||(this.timer=setInterval(function(){engine.updateTrackerList()},engine.settings.backgroundUpdateInterval))},stop:function(){this.timer&&
clearInterval(this.timer);this.timer=null;this.state=0}},getToken:function(a,d,b){if(null===engine.settings.login||null===engine.settings.password)return d&&d({status:0,statusText:"Login or password is not found!"}),engine.publicStatus("Login or password is not found!");engine.publicStatus("Try get token!"+(b?" Retry: "+b:""));engine.request({url:engine.varCache.webUiUrl+"token.html",headers:{Authorization:"Basic "+btoa(engine.settings.login+":"+engine.settings.password)}},function(c,e,g){if(c)return engine.publicStatus("Get token error! "+
c),b=b||0,b++,4>b?engine.getToken.call(engine,a,d,b):d&&d(c);(c=g.match(/>([^<]+)</))?(c=c[1],engine.publicStatus("Token is found!")):engine.publicStatus("Token not found!");engine.varCache.token=c;engine.publicStatus("");a&&a()})},sendAction:function(a,d,b,c){if(void 0===engine.varCache.token)return engine.getToken(function(){engine.sendAction.call(engine,a,d,b,c||1)});var e=a;"string"===typeof e?e="token="+engine.varCache.token+"&"+e:e.token=engine.varCache.token;var g=engine.varCache.webUiUrl;
if(e.hasOwnProperty("torrent_file")){var f="POST";var h=new FormData;h.append("torrent_file",e.torrent_file);e={};for(var k in a)e[k]=a[k];delete e.torrent_file;g+="?"+engine.param(e);e=h}else f="GET";engine.request({type:f,url:g,headers:{Authorization:"Basic "+btoa(engine.settings.login+":"+engine.settings.password)},data:e},function(g,f,e){if(g){c=c||0;c++;400===f.statusCode&&(engine.varCache.token=void 0);if(2>c)return engine.sendAction.call(engine,a,d,b,c);engine.publicStatus("Can't send action! "+
g);return b&&b()}try{engine.settings.fixCirilicTitle&&(e=engine.fixCirilicTitle(e)),e=JSON.parse(e)}catch(t){return engine.publicStatus("Data parse error!")}engine.publicStatus("");d&&d(e);engine.readResponse(e,a.cid)})},readResponse:function(a,d){if(void 0!==a.torrentm)for(var b=engine.varCache.torrents,c=0,e;e=a.torrentm[c];c++)for(var g=0,f;f=b[g];g++)if(f[0]===e){b.splice(g,1);break}b=a.torrents||a.torrentp;void 0!==b&&engine.utils(engine.varCache.torrents,b);if(void 0!==a.torrents)engine.varCache.torrents=
a.torrents;else if(void 0!==a.torrentp){b=engine.varCache.torrents;e=[];c=0;for(var h;h=a.torrentp[c];c++){var k=!1;for(g=0;f=b[g];g++)if(f[0]===h[0]){b[g]=h;k=!0;break}!1===k&&(e.push(h),b.push(h))}engine.varCache.newFileListener&&engine.varCache.newFileListener(e,d)}void 0!==a.label&&(engine.varCache.labels=a.label);void 0!==a.settings&&(engine.varCache.settings=a.settings);engine.settings.displayActiveTorrentCountIcon&&engine.displayActiveItemsCountIcon(engine.varCache.torrents)},updateTrackerList:function(){engine.sendAction({list:1,
cid:engine.varCache.cid},function(a){void 0!==a.torrentc&&(engine.varCache.cid=a.torrentc)},function(){engine.timer.stop()})},loadSettings:function(a){var d=engine.defaultSettings,b=[],c;for(c in d)b.push(c);var e=["fileListColumnList","torrentListColumnList"];e.forEach(function(a){b.push(a)});b.push("language");b.push("folderList");b.push("labelList");b.push("ut_port");b.push("ut_ip");b.push("ut_path");b.push("ssl");mono.storage.local.get(b,function(b){var c={};b.hasOwnProperty("port")||!b.ut_port||
isNaN(parseInt(b.ut_port))||(b.port=parseInt(b.ut_port));!b.hasOwnProperty("ip")&&b.ut_ip&&(b.ip=b.ut_ip);!b.hasOwnProperty("path")&&b.path&&(b.path=b.ut_path);b.hasOwnProperty("useSSL")||1!==b.ssl||(b.useSSL=b.ssl);for(var g in d)c[g]=b.hasOwnProperty(g)?b[g]:d[g];c.lang=b.language;engine.varCache.folderList=b.folderList||engine.varCache.folderList;engine.varCache.labelList=b.labelList||engine.varCache.labelList;engine.settings=c;e.forEach(function(a){var c="default"+engine.capitalize(a);engine[a]=
b.hasOwnProperty(a)?b[a]:engine[c];if(engine[c].length!==engine[a].length)for(var d=0,e;e=engine[c][d];d++){for(var g=!1,f=0,h;h=engine[a][f];f++)if(h.column===e.column){g=!0;break}g||("checkbox"===e.column?engine[a].unshift(e):engine[a].push(e))}});engine.varCache.webUiUrl=(c.useSSL?"https://":"http://")+c.ip+":"+c.port+"/"+c.path;return a()})},setLanguage:function(a){var d=engine.language,b;for(b in a)d[b]=a[b]},getNavLanguage:function(){var a="",d=navigator.language;/^\w{2}-|^\w{2}$/.test(d)&&
(a=d);return a},loadLanguage:function(a){var d=engine.settings.lang;"string"===typeof d&&(d=d.substr(0,2));(function g(a,d){/^pt/.test(a)?a="pt_BR":/^zh/.test(a)&&(a="zh_CN");mono.getLanguage(a,function(c,e){c?"en"!==a?g("en",d):d():(engine.setLanguage(e),d())})})(d||mono.getLoadedLocale(),a)},getLanguage:function(a){engine.language={};engine.loadLanguage(a)},trafficCounter:function(a){for(var d=0,b=0,c=0,e;e=a[c];c++)d+=e[9],b+=e[8];a=engine.varCache.trafficList[0].values;c=engine.varCache.trafficList[1].values;
e=parseInt(Date.now()/1E3)-engine.varCache.startTime;a.push({time:e,pos:d});c.push({time:e,pos:b});90<a.length&&(a.shift(),c.shift())},showNotification:function(a,d,b,c){c=c||{};c.notificationTimeout=engine.settings.notificationTimeout;mono.showNotification(a,d,b,c)},onCompleteNotification:function(a,d){if(0!==a.length)for(var b=0,c;c=d[b];b++)if(1E3===c[4])for(var e=0,g;g=a[e];e++)g[0]!==c[0]||1E3===g[4]||g[24]||engine.showNotification(engine.icons.complete,c[2],void 0!==c[21]?engine.language.OV_COL_STATUS+
": "+c[21]:"")},setBadgeText:function(a){engine.setBadgeText.lastText=a;mono.setBadgeText(a);engine.settings.badgeColor&&mono.setBadgeBackgroundColor(engine.settings.badgeColor)},displayActiveItemsCountIcon:function(a){for(var d=0,b=0,c;c=a[b];b++)1E3===c[4]||void 0!==c[24]&&0!==c[24]||d++;engine.varCache.activeCount!==d&&(engine.varCache.activeCount=d,engine.setBadgeText(d?String(d):""))},utils:function(a,d){engine.settings.showSpeedGraph&&engine.trafficCounter(d);engine.settings.showNotificationOnDownloadCompleate&&
engine.onCompleteNotification(a.slice(0),d)},downloadFile:function(a,d,b){var c=new XMLHttpRequest;try{c.open("GET",a,!0)}catch(e){engine.showNotification(engine.icons.error,c.status,engine.language.unexpectedError);return}c.responseType="blob";b&&c.setRequestHeader("Referer",b);c.onprogress=function(a){if(10485760<a.total||10485760<a.loaded)c.abort(),engine.showNotification(engine.icons.error,engine.language.OV_FL_ERROR,engine.language.fileSizeError)};c.onload=function(){return d(c.response)};c.onerror=
function(){0===c.status?engine.showNotification(engine.icons.error,c.status,engine.language.unexpectedError):engine.showNotification(engine.icons.error,c.status,c.statusText)};c.send()},setOnFileAddListener:function(a,d){engine.varCache.newFileListener=function(b,c){c===d&&(delete engine.varCache.newFileListener,0===b.length?engine.showNotification(engine.icons.error,engine.language.torrentFileExists,""):1===b.length&&(b=b[0],a&&!b[11]&&engine.sendAction({action:"setprops",s:"label",hash:b[0],v:a}),
engine.settings.selectDownloadCategoryOnAddItemFromContextMenu&&mono.storage.local.set({selectedLabel:{label:"DL",custom:1}}),engine.showNotification(engine.icons.add,b[2],engine.language.torrentAdded)))}},sendFile:function(a,d,b,c){var e;(e="string"===typeof a)&&"magnet:"!==a.substr(0,7).toLowerCase()?engine.downloadFile(a,function(e){"blob:"===a.substr(0,5).toLowerCase()&&URL.revokeObjectURL(a);engine.sendFile(e,d,b,c)},c):engine.sendAction({list:1},function(c){var f=c.torrentc;c={};e?(c.action=
"add-url",c.s=a):(c.action="add-file",c.torrent_file=a);d&&(c.download_dir=d.download_dir,c.path=d.path);engine.sendAction(c,function(a){void 0!==a.error?engine.showNotification(engine.icons.error,engine.language.OV_FL_ERROR,a.error):(engine.setOnFileAddListener(b,f),engine.sendAction({list:1,cid:f}))})})},fixCirilicTitle:function(){var a="\\u037777777720\\u037777777620 \\u037777777720\\u037777777621 \\u037777777720\\u037777777622 \\u037777777720\\u037777777623 \\u037777777720\\u037777777624 \\u037777777720\\u037777777625 \\u037777777720\\u037777777601 \\u037777777720\\u037777777626 \\u037777777720\\u037777777627 \\u037777777720\\u037777777630 \\u037777777720\\u037777777631 \\u037777777720\\u037777777632 \\u037777777720\\u037777777633 \\u037777777720\\u037777777634 \\u037777777720\\u037777777635 \\u037777777720\\u037777777636 \\u037777777720\\u037777777637 \\u037777777720\\u037777777640 \\u037777777720\\u037777777641 \\u037777777720\\u037777777642 \\u037777777720\\u037777777643 \\u037777777720\\u037777777644 \\u037777777720\\u037777777645 \\u037777777720\\u037777777646 \\u037777777720\\u037777777647 \\u037777777720\\u037777777650 \\u037777777720\\u037777777651 \\u037777777720\\u037777777652 \\u037777777720\\u037777777653 \\u037777777720\\u037777777654 \\u037777777720\\u037777777655 \\u037777777720\\u037777777656 \\u037777777720\\u037777777657 \\u037777777720\\u037777777660 \\u037777777720\\u037777777661 \\u037777777720\\u037777777662 \\u037777777720\\u037777777663 \\u037777777720\\u037777777664 \\u037777777720\\u037777777665 \\u037777777721\\u037777777621 \\u037777777720\\u037777777666 \\u037777777720\\u037777777667 \\u037777777720\\u037777777670 \\u037777777720\\u037777777671 \\u037777777720\\u037777777672 \\u037777777720\\u037777777673 \\u037777777720\\u037777777674 \\u037777777720\\u037777777675 \\u037777777720\\u037777777676 \\u037777777720\\u037777777677 \\u037777777721\\u037777777600 \\u037777777721\\u037777777601 \\u037777777721\\u037777777602 \\u037777777721\\u037777777603 \\u037777777721\\u037777777604 \\u037777777721\\u037777777605 \\u037777777721\\u037777777606 \\u037777777721\\u037777777607 \\u037777777721\\u037777777610 \\u037777777721\\u037777777611 \\u037777777721\\u037777777612 \\u037777777721\\u037777777613 \\u037777777721\\u037777777614 \\u037777777721\\u037777777615 \\u037777777721\\u037777777616 \\u037777777721\\u037777777617".split(" ");
return function(d){if(-1===d.indexOf("\\u03777777772"))return d;for(var b=0,c;c=a[b];b++)for(;-1!==d.indexOf(c);)d=d.replace(c,"\u0410\u0411\u0412\u0413\u0414\u0415\u0401\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0451\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"[b]);
return d}}(),inCp1251:function(a){for(var d="",b,c,e=0,g=a.length;e<g;e++){c=a.charAt(e);var f=b=c.charCodeAt(0);1039<b&&1104>b?(f-=848,b="%"+f.toString(16)):1025===b?(f=168,b="%"+f.toString(16)):1105===b?(f=184,b="%"+f.toString(16)):32===b?(f=32,b="%"+f.toString(16)):b=10===b?"%0A":c;d+=b}return d},onCtxMenuCall:function(a){var d=a.linkUrl,b=a.menuItemId,c=!1,e=engine.createFolderCtxMenu.contextMenu,g=e[0]?e[0]:["0","",""];if("newFolder"===b){var f=prompt(engine.language.enterNewDirPath,g[1]);if(!f)return;
var h=g[0];b=-1;g=0;for(var k;k=e[g];g++)if(k[1]===f&&k[0]===h){b=g;break}-1===b&&(b=e.length,e.push([h,f,""]),engine.varCache.folderList.push([h,f,""]),c=!0)}if("newLabel"===b){f=prompt(engine.language.enterNewLabel);if(!f)return;b=-1;for(g=0;k=e[g];g++)if(k===f){b=g;break}-1===b&&(b=e.length,e.push(f),engine.varCache.labelList.push(f),c=!0)}if("main"===b||"default"===b)return engine.sendFile(d,void 0,void 0,a.referer);var m,l;k=e[b];"string"===typeof k?l=k:m={download_dir:k[0],path:k[1]};c&&mono.storage.local.set({folderList:engine.varCache.folderList,
labelList:engine.varCache.labelList},function(){engine.createFolderCtxMenu()});engine.sendFile(d,m,l,a.referer)},listToTreeList:function(a){for(var d=[],b={},c,e=0,g=0,f;f=a[g];g++){var h=f[1];void 0===c?c=-1===h.indexOf("/")?-1===h.indexOf("\\")?void 0:"\\":"/":f[1]="\\"===c?h.replace(/\//g,"\\"):h.replace(/\\/g,"/")}void 0===c&&(c="");for(g=0;f=a[g];g++){var k=f[0];if(h=f[1]){f=c+c;var m=[];if(0===h.search(/[a-zA-Z]{1}:(\/\/|\\\\)/)){var l=h.split(":"+f);2===l.length&&(l[0]+=":"+f,m.push(l[0]),
h=l[1])}h=0!==c.length?h.split(c):[h];m=m.concat(h);""===m[0]&&(m.shift(),m[0]=c+m[0]);""===m.slice(-1)[0]&&m.splice(-1);l=h=void 0;for(var n=0,t=m.length;n<t;n++){var q=void 0!==h?h:b,p=m[n];l=void 0===l?p:1===n&&l.slice(-3)===":"+f?l+p:l+(c+p);h=q[p];void 0===h&&(q===b&&e++,h=q[p]={arrayIndex:d.length,currentPath:p},d.push([k,l]))}h&&(h.end=!0)}}var r=[],u=function(a,b){var d=[];for(f in b){var e=b[f];void 0!==e.currentPath&&d.push(e)}var f=d.length;if(1===f&&void 0===b.end)f=b.currentPath,b.currentPath.slice(-1)!==
c&&(f+=c),d[0].currentPath=f+d[0].currentPath,u(a,d[0]);else{var g=(f=0!==f)?"p"+String(b.arrayIndex):String(b.arrayIndex);b.currentPath&&(r.push({id:g,parentId:a,title:b.currentPath}),f&&r.push({id:g.substr(1),parentId:g,title:engine.language.currentDirectory}));d.forEach(function(a){u(g,a)})}};for(f in b)u("main",b[f]);return{tree:r,list:d}},createFolderCtxMenu:function(){mono.contextMenusRemoveAll(function(){var a,d;if((a=1===engine.settings.ctxMenuType)||(d=2===engine.settings.ctxMenuType)){var b=
engine.createFolderCtxMenu.contextMenu=[],c=engine.varCache.folderList,e=engine.varCache.labelList;mono.contextMenusCreate({id:"main",title:engine.language.addInTorrentClient,contexts:["link"],onclick:engine.onCtxMenuCall},function(){if(a){Array.prototype.push.apply(b,c);if(0<c.length)if(engine.settings.treeViewContextMenu){for(var g=engine.listToTreeList(c.slice(0)),f=0,h;h=g.tree[f];f++)mono.contextMenusCreate({id:h.id,parentId:h.parentId,title:h.title,contexts:["link"],onclick:engine.onCtxMenuCall});
b.splice(0);Array.prototype.push.apply(b,g.list)}else for(f=0;h=c[f];f++)mono.contextMenusCreate({id:String(f),parentId:"main",title:h[2]||h[1],contexts:["link"],onclick:engine.onCtxMenuCall});engine.settings.showDefaultFolderContextMenuItem&&mono.contextMenusCreate({id:"default",parentId:"main",title:engine.language.defaultPath,contexts:["link"],onclick:engine.onCtxMenuCall});(0<c.length||engine.settings.showDefaultFolderContextMenuItem)&&mono.contextMenusCreate({id:"newFolder",parentId:"main",title:engine.language.add+
"...",contexts:["link"],onclick:engine.onCtxMenuCall})}else if(d&&0<e.length){Array.prototype.push.apply(b,e);for(f=0;h=e[f];f++)mono.contextMenusCreate({id:String(f),parentId:"main",title:h,contexts:["link"],onclick:engine.onCtxMenuCall});mono.contextMenusCreate({id:"newLabel",parentId:"main",title:engine.language.add+"...",contexts:["link"],onclick:engine.onCtxMenuCall})}})}})},run:function(){engine.loadSettings(function(){engine.getLanguage(function(){engine.varCache.isReady=1;for(var a=engine.varCache.msgStack,
d,b;b=a.shift();)if(d=engine.onMessage.apply(engine,b),!0!==d)b[2](null);engine.updateTrackerList();engine.timer.start();engine.createFolderCtxMenu()})})},onMessage:function(a,d,b){if(1!==engine.varCache.isReady)return engine.varCache.msgStack.push(arguments),!0;var c=engine.actionList[a.action];return c&&c(a,b)},storageCache:{},actionList:{getLanguage:function(a,d){d(engine.language)},getSettings:function(a,d){d(engine.settings)},getDefaultSettings:function(a,d){d(engine.defaultSettings)},getTrColumnArray:function(a,
d){d(engine.torrentListColumnList)},getFlColumnArray:function(a,d){d(engine.fileListColumnList)},getRemoteTorrentList:function(a,d){d(engine.varCache.torrents)},getRemoteLabels:function(a,d){d(engine.varCache.labels)},getRemoteSettings:function(a,d){d(engine.varCache.settings)},getPublicStatus:function(a,d){d(engine.varCache.lastPublicStatus)},api:function(a,d){engine.sendAction(a.data,d);return!0},setTrColumnArray:function(a,d){engine.torrentListColumnList=a.data;mono.storage.local.set({torrentListColumnList:a.data},
d);return!0},setFlColumnArray:function(a,d){engine.fileListColumnList=a.data;mono.storage.local.set({fileListColumnList:a.data},d);return!0},onSendFile:function(a,d){if(a.base64){d=a.base64;var b=a.type;delete a.base64;delete a.type;a.url=utils.base64ToUrl(d,b)}engine.sendFile(a.url,a.folder,a.label)},getTraffic:function(a,d){d({trafficList:engine.varCache.trafficList,startTime:engine.varCache.startTime})},getDirList:function(a,d){engine.sendAction({action:"list-dirs"},d,function(){d({})});return!0},
checkSettings:function(a,d){engine.loadSettings(function(){engine.getLanguage(function(){engine.getToken(function(){return d({})},function(a){return d({error:a})})})});return!0},reloadSettings:function(a,d){engine.loadSettings(function(){engine.getLanguage(function(){engine.createFolderCtxMenu();!engine.settings.displayActiveTorrentCountIcon&&0<engine.varCache.activeCount&&(engine.varCache.activeCount=0,engine.setBadgeText(""));d()})});return!0},managerIsOpen:function(a,d){1!==engine.timer.state&&
engine.timer.start()},changeBadgeColor:function(a){engine.settings.badgeColor=a.color;engine.setBadgeText(engine.setBadgeText.lastText||"0")}},init:function(){engine.setBadgeText("");engine.varCache.msgStack=[];mono.onMessage.addListener(engine.onMessage);engine.run()}};mono.onReady(function(){engine.init()});
